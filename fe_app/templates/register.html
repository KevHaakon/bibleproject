{% extends "base.html" %}

{% block title %}Registro - Fe: Creer para Crecer{% endblock %}

{% block content %}
    <div class="container">
        <h2>Registro de Usuario</h2>
        <form action="/register" method="post">
             <div class="form-group">
                <label for="first_name">Nombre:</label>
                <input type="text" id="first_name" name="first_name" required>
            </div>
             <div class="form-group">
                <label for="last_name">Apellido:</label>
                <input type="text" id="last_name" name="last_name" required>
            </div>
             <div class="form-group">
                <label for="email">Correo Electrónico:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="username">Nombre de Usuario:</label>
                <input type="text" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Contraseña:</label>
                <input type="password" id="password" name="password" required>
            </div>
             <div class="form-group">
                <label for="date_of_birth">Fecha de Nacimiento:</label>
                <input type="date" id="date_of_birth" name="date_of_birth">
            </div>
             <div class="form-group">
                <label for="country">País:</label>
                <select id="country" name="country" required>
                    <option value="">-- Selecciona un país --</option>
                    <option value="CO">Colombia</option>
                    <option value="MX">México</option>
                    <option value="ES">España</option>
                    <option value="AR">Argentina</option>
                    <option value="CL">Chile</option>
                    <option value="PE">Perú</option>
                    <option value="VE">Venezuela</option>
                    <option value="US">Estados Unidos</option>
                    <option value="CA">Canadá</option>
                    <option value="BR">Brasil</option>
                </select>
            </div>

            <button type="submit">Registrarse</button>
        </form>
        <p class="message" id="response-message"></p>
        <div class="links">
            ¿Ya tienes una cuenta? <a href="{{ url_for('auth.login') }}">Inicia Sesión</a>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('form');
            const responseMessage = document.getElementById('response-message');
            form.addEventListener('submit', async function(event) {
                event.preventDefault();
                const formData = new FormData(form);
                responseMessage.textContent = '';
                responseMessage.style.color = 'red';
                try {
                    const response = await fetch('/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded', },
                        body: new URLSearchParams(formData).toString()
                    });
                    const result = await response.json();
                    responseMessage.textContent = result.message;
                    if (response.ok) {
                        responseMessage.style.color = 'green';
                        form.reset();
                    } else {
                        responseMessage.style.color = 'red';
                    }
                } catch (error) {
                    console.error('Error en la solicitud de registro:', error);
                    responseMessage.textContent = 'Hubo un error al procesar tu registro. Inténtalo de nuevo.';
                    responseMessage.style.color = 'red';
                }
            });
        });
    </script>
{% endblock %}